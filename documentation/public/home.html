<!DOCTYPE html>

<html>
<head>
  <title>home.js</title>
  <meta http-equiv="content-type" content="text/html; charset=UTF-8">
  <meta name="viewport" content="width=device-width, target-densitydpi=160dpi, initial-scale=1.0; maximum-scale=1.0; user-scalable=0;">
  <link rel="stylesheet" media="all" href="../docco.css" />
</head>
<body>
  <div id="container">
    <div id="background"></div>
    
      <ul id="jump_to">
        <li>
          <a class="large" href="javascript:void(0);">Jump To &hellip;</a>
          <a class="small" href="javascript:void(0);">+</a>
          <div id="jump_wrapper">
          <div id="jump_page_wrapper">
            <div id="jump_page">
              
                
                <a class="source" href="auth.html">
                  public/auth.js
                </a>
              
                
                <a class="source" href="chat.html">
                  public/chat.js
                </a>
              
                
                <a class="source" href="home.html">
                  public/home.js
                </a>
              
                
                <a class="source" href="index.html">
                  public/index.js
                </a>
              
            </div>
          </div>
        </li>
      </ul>
    
    <ul class="sections">
        
          <li id="title">
              <div class="annotation">
                  <h1>home.js</h1>
              </div>
          </li>
        
        
        
        <li id="section-1">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-1">&#182;</a>
              </div>
              
            </div>
            
            <div class="content"><div class='highlight'><pre><span class="hljs-built_in">document</span>.getElementById(<span class="hljs-string">"error"</span>).style.visibility = <span class="hljs-string">"hidden"</span>;</pre></div></div>
            
        </li>
        
        
        <li id="section-2">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-2">&#182;</a>
              </div>
              <p>The following function determines if the inputted URL is a valid Youtube video URL. 
If it is a valid Youtube video URL, the video id portion of the youtube video link is returned. If not, false is returned.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">isYoutube</span>(<span class="hljs-params">getURL</span>)</span>{
  <span class="hljs-keyword">var</span> videoid = getURL.match(<span class="hljs-regexp">/(?:https?:\/{2})?(?:w{3}\.)?youtu(?:be)?\.(?:com|be)(?:\/watch\?v=|\/)([^\s&amp;]+)/</span>);
  <span class="hljs-keyword">if</span>(videoid != <span class="hljs-literal">null</span>){
    <span class="hljs-keyword">return</span>(<span class="hljs-string">"video id = "</span>,videoid[<span class="hljs-number">1</span>]);
  } 
  <span class="hljs-keyword">else</span>{ 
    <span class="hljs-keyword">return</span>(<span class="hljs-literal">false</span>)
  }
}</pre></div></div>
            
        </li>
        
        
        <li id="section-3">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-3">&#182;</a>
              </div>
              <p>The following function determines if the inputted password is acceptable (between 8 to 15 characters which contain at least one lowercase letter, one uppercase letter, one numeric digit, and one special character).
If the password is acceptable, true is returned. If not, false is returned.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">CheckPassword</span>(<span class="hljs-params">inputtxt</span>)</span>{ 
  <span class="hljs-keyword">var</span> decimal=  <span class="hljs-regexp">/^(?=.*\d)(?=.*[a-z])(?=.*[A-Z])(?=.*[^a-zA-Z0-9])(?!.*\s).{8,15}$/</span>;
  <span class="hljs-keyword">if</span>(inputtxt.match(decimal)){
    <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;
  }
  <span class="hljs-keyword">else</span>{ 
    <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;
  }
} 

<span class="hljs-keyword">let</span> linksList = [];</pre></div></div>
            
        </li>
        
        
        <li id="section-4">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-4">&#182;</a>
              </div>
              <p>Below, an event listener for “click” is attached to the button element with ID “another”. This button is clicked if the user wants to input another Youtube video link.
The call-back function checks to see if the most recently inputted URL is indeed a valid Youtube video URL.
If the URL is a valid Youtube video URL, the URL is pushed to the array called “linksList”. If not, an error message becomes visible on the screen.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre><span class="hljs-built_in">document</span>.getElementById(<span class="hljs-string">"another"</span>).addEventListener(<span class="hljs-string">'click'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>)</span>{
  <span class="hljs-keyword">let</span> newLink = <span class="hljs-built_in">String</span>(<span class="hljs-built_in">document</span>.getElementById(<span class="hljs-string">"link"</span>).value);
  <span class="hljs-keyword">if</span> (isYoutube(newLink) !== <span class="hljs-literal">false</span>){
    <span class="hljs-built_in">document</span>.getElementById(<span class="hljs-string">"error"</span>).style.visibility = <span class="hljs-string">"hidden"</span>;
    linksList.push(<span class="hljs-built_in">String</span>(<span class="hljs-built_in">document</span>.getElementById(<span class="hljs-string">"link"</span>).value));
    <span class="hljs-built_in">document</span>.getElementById(<span class="hljs-string">"link"</span>).value = <span class="hljs-string">""</span>;
  }
  <span class="hljs-keyword">else</span>{
    <span class="hljs-built_in">document</span>.getElementById(<span class="hljs-string">"error"</span>).style.visibility = <span class="hljs-string">"visible"</span>;
  }
});</pre></div></div>
            
        </li>
        
        
        <li id="section-5">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-5">&#182;</a>
              </div>
              <p>Below, an event listener for “click” is attached to the button element with ID “submit1”. This button is clicked if the user is ready to CREATE a group for watching their chosen Youtube videos.
The call-back function determines if the user has met all of the requirements to create a group.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre><span class="hljs-built_in">document</span>.getElementById(<span class="hljs-string">"submit1"</span>).addEventListener(<span class="hljs-string">'click'</span>, <span class="hljs-keyword">async</span> <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>)</span>{</pre></div></div>
            
        </li>
        
        
        <li id="section-6">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-6">&#182;</a>
              </div>
              <p>The last URL inputted by the user is stored inside “lastLink” and the group password inputted by the user is stored inside “pass”.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  <span class="hljs-keyword">let</span> lastLink = <span class="hljs-built_in">String</span>(<span class="hljs-built_in">document</span>.getElementById(<span class="hljs-string">"link"</span>).value);
  <span class="hljs-keyword">let</span> pass = <span class="hljs-built_in">String</span>(<span class="hljs-built_in">document</span>.getElementById(<span class="hljs-string">"groupPass"</span>).value);</pre></div></div>
            
        </li>
        
        
        <li id="section-7">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-7">&#182;</a>
              </div>
              <p>The following database query checks to see if the password inputted by the user already exists in the “groups” collection of the database. If it does, that means that the password inputted by the user has already been used and is non-unique.              </p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  db.collection(<span class="hljs-string">'groups'</span>).where(<span class="hljs-string">'groupPass'</span>, <span class="hljs-string">'=='</span>, pass).get().then(<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">querySnapshot</span>)</span>{
      <span class="hljs-keyword">if</span> (!querySnapshot.empty){</pre></div></div>
            
        </li>
        
        
        <li id="section-8">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-8">&#182;</a>
              </div>
              <p>Alert is thrown if group password entered by the user is non-unique.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        alert(<span class="hljs-string">"It appears that there already exists a group with that password. Try again!"</span>);
      }
      <span class="hljs-keyword">else</span>{</pre></div></div>
            
        </li>
        
        
        <li id="section-9">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-9">&#182;</a>
              </div>
              <p>If group password entered by the user is indeed unique, the inputted group password is checked to see if it is acceptable.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        <span class="hljs-keyword">if</span> (CheckPassword(pass)){</pre></div></div>
            
        </li>
        
        
        <li id="section-10">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-10">&#182;</a>
              </div>
              <p>If the inputted group password is acceptable, the last URL inputted by the user is checked to see if it is a valid Youtube video URL.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>          <span class="hljs-keyword">if</span> (isYoutube(lastLink) !== <span class="hljs-literal">false</span>){</pre></div></div>
            
        </li>
        
        
        <li id="section-11">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-11">&#182;</a>
              </div>
              <p>If the last URL inputted by the user is indeed a youtube video URL, then it is pushed to the “linksList” array.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>            linksList.push(<span class="hljs-built_in">String</span>(<span class="hljs-built_in">document</span>.getElementById(<span class="hljs-string">"link"</span>).value));</pre></div></div>
            
        </li>
        
        
        <li id="section-12">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-12">&#182;</a>
              </div>
              <p>Since now, all of the URLs within “linksList” are valid URL video URLs, when they are all passed into the “isYoutube” function, the video ID’s of the URLs are returned and stored inside the “idsList” array.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>            <span class="hljs-keyword">let</span> idsList = [];
            <span class="hljs-keyword">for</span> (<span class="hljs-keyword">const</span> link <span class="hljs-keyword">of</span> linksList){
              idsList.push(isYoutube(link));
            }</pre></div></div>
            
        </li>
        
        
        <li id="section-13">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-13">&#182;</a>
              </div>
              <p>A document is then added to the “groups” collection within the database containing the array of video ID’s of the links inputted by the user and the group password created by the user.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>            db.collection(<span class="hljs-string">"groups"</span>).add({
              <span class="hljs-attr">videoIds</span>: idsList,
              <span class="hljs-attr">groupPass</span>: pass
            }).then(<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">docRef</span>)</span>{</pre></div></div>
            
        </li>
        
        
        <li id="section-14">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-14">&#182;</a>
              </div>
              <p>Once the document is added to the collection, the list of video ID’s is stored inside “idsList” within local storage. Because “idsList” is not sent to empty string, we will know later on that the user is creating a group. </p>

            </div>
            
            <div class="content"><div class='highlight'><pre>              localStorage.setItem(<span class="hljs-string">"idsList"</span>, <span class="hljs-built_in">JSON</span>.stringify(idsList));</pre></div></div>
            
        </li>
        
        
        <li id="section-15">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-15">&#182;</a>
              </div>
              <p>And since “idsList2” in local storage is set to “”, we will know that the user is not joining a group.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>              localStorage.setItem(<span class="hljs-string">"idsList2"</span>, <span class="hljs-built_in">JSON</span>.stringify([<span class="hljs-string">""</span>]));</pre></div></div>
            
        </li>
        
        
        <li id="section-16">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-16">&#182;</a>
              </div>
              <p>The ID of the document that was just added to the collection then is set to “groupID” in local storage, which will be used as the group’s security token.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>              localStorage.setItem(<span class="hljs-string">"groupID"</span>, docRef.id);</pre></div></div>
            
        </li>
        
        
        <li id="section-17">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-17">&#182;</a>
              </div>
              <p>The window location then changes to the video-watching page so that the user can watch the videos that they just chose with rest of their group.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>              <span class="hljs-built_in">window</span>.location.href = <span class="hljs-string">'./video.html'</span>;
            });
          }
          <span class="hljs-keyword">else</span>{</pre></div></div>
            
        </li>
        
        
        <li id="section-18">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-18">&#182;</a>
              </div>
              <p>If last inputted URL is not a valid Youtube video URL, an error message is displayed.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>            <span class="hljs-built_in">document</span>.getElementById(<span class="hljs-string">"error"</span>).style.visibility = <span class="hljs-string">"visible"</span>;
          }
        }
        <span class="hljs-keyword">else</span>{
          <span class="hljs-keyword">if</span> (isYoutube(lastLink) !== <span class="hljs-literal">false</span>){
            <span class="hljs-built_in">document</span>.getElementById(<span class="hljs-string">"error"</span>).style.visibility = <span class="hljs-string">"hidden"</span>;
          }
          <span class="hljs-keyword">else</span>{
            <span class="hljs-built_in">document</span>.getElementById(<span class="hljs-string">"error"</span>).style.visibility = <span class="hljs-string">"visible"</span>;
          }</pre></div></div>
            
        </li>
        
        
        <li id="section-19">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-19">&#182;</a>
              </div>
              <p>If password is unacceptable, alert is thrown to user.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>          alert(<span class="hljs-string">"password must be between 8 to 15 characters which contain at least one lowercase letter, one uppercase letter, one numeric digit, and one special character."</span>);
        }
      }
  });
});</pre></div></div>
            
        </li>
        
        
        <li id="section-20">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-20">&#182;</a>
              </div>
              <p>//Below, an event listener for “click” is attached to the button element with ID “submit2”. This button is clicked if the user is ready to JOIN a group for watching Youtube videos.
The call-back function determines if the group password inputted by the user exists within the database collection.
If the inputted-group password does exist, then the user is taken to the video-watching page (./video.html) so that they can watch Youtube videos with the rest of their group members.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre><span class="hljs-built_in">document</span>.getElementById(<span class="hljs-string">"submit2"</span>).addEventListener(<span class="hljs-string">'click'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>)</span>{</pre></div></div>
            
        </li>
        
        
        <li id="section-21">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-21">&#182;</a>
              </div>
              <p>Inputted group password is stored inside “pass2”.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  <span class="hljs-keyword">let</span> pass2 = <span class="hljs-built_in">String</span>(<span class="hljs-built_in">document</span>.getElementById(<span class="hljs-string">"groupPass2"</span>).value);</pre></div></div>
            
        </li>
        
        
        <li id="section-22">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-22">&#182;</a>
              </div>
              <p>If the collection called “groups” within the database does not contain a document with the user-inputted group password, the user is alerted.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  db.collection(<span class="hljs-string">'groups'</span>).where(<span class="hljs-string">'groupPass'</span>, <span class="hljs-string">'=='</span>, pass2).get().then(<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">querySnapshot</span>)</span>{
    <span class="hljs-keyword">if</span> (querySnapshot.empty){
      alert(<span class="hljs-string">"It appears that there does not exist a group with the password you inputted. Try again!"</span>);
    }</pre></div></div>
            
        </li>
        
        
        <li id="section-23">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-23">&#182;</a>
              </div>
              <p>If the user-inputted group password is within the collection, then the array of Youtube video ID’s corresponding to the document with the group password inputted by the user are stored inside “idsList2”.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    <span class="hljs-keyword">else</span>{
      <span class="hljs-keyword">let</span> promise2 = <span class="hljs-keyword">new</span> <span class="hljs-built_in">Promise</span>(<span class="hljs-function">(<span class="hljs-params">resolve, reject</span>) =&gt;</span> {
        db.collection(<span class="hljs-string">'groups'</span>).where(<span class="hljs-string">'groupPass'</span>, <span class="hljs-string">'=='</span>, pass2).get().then(<span class="hljs-function">(<span class="hljs-params">querySnapshot</span>) =&gt;</span> {
          querySnapshot.forEach(<span class="hljs-function"><span class="hljs-params">doc</span> =&gt;</span> {
            <span class="hljs-keyword">if</span> (doc.exists){
              resolve(doc.data().videoIds);
            }
          });
        });
      });
      promise2.then(<span class="hljs-function">(<span class="hljs-params">success</span>) =&gt;</span> {
        <span class="hljs-keyword">let</span> idsList2 = success;</pre></div></div>
            
        </li>
        
        
        <li id="section-24">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-24">&#182;</a>
              </div>
              <p>“idsList2” within local storage is then set to the list of video ID’s corresponding to the group password inputted by the user, indicating that the user is JOINING a group.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        localStorage.setItem(<span class="hljs-string">"idsList2"</span>, <span class="hljs-built_in">JSON</span>.stringify(idsList2));</pre></div></div>
            
        </li>
        
        
        <li id="section-25">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-25">&#182;</a>
              </div>
              <p>“idsList” within local storage is set to “”, indicating that the user is NOT CREATING a group.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        localStorage.setItem(<span class="hljs-string">"idsList"</span>, <span class="hljs-built_in">JSON</span>.stringify([<span class="hljs-string">""</span>]));
      });</pre></div></div>
            
        </li>
        
        
        <li id="section-26">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-26">&#182;</a>
              </div>
              <p>The ID of the document corresponding to the group password inputted by the user is then set to “groupID2”.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>      <span class="hljs-keyword">let</span> promise3 = <span class="hljs-keyword">new</span> <span class="hljs-built_in">Promise</span>(<span class="hljs-function">(<span class="hljs-params">resolve, reject</span>) =&gt;</span> {
        db.collection(<span class="hljs-string">'groups'</span>).where(<span class="hljs-string">'groupPass'</span>, <span class="hljs-string">'=='</span>, pass2).get().then(<span class="hljs-function">(<span class="hljs-params">querySnapshot</span>) =&gt;</span> {
          querySnapshot.forEach(<span class="hljs-function"><span class="hljs-params">doc</span> =&gt;</span> {
            <span class="hljs-keyword">if</span> (doc.exists){
              resolve(doc.id);
            }
          });
        });
      });
      promise3.then(<span class="hljs-function">(<span class="hljs-params">success</span>) =&gt;</span> {
        <span class="hljs-keyword">let</span> groupID2 = success;</pre></div></div>
            
        </li>
        
        
        <li id="section-27">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-27">&#182;</a>
              </div>
              <p>“groupID2” within local storage is then set to the ID of the document corresponding to the group password inputted by the user.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        localStorage.setItem(<span class="hljs-string">"groupID2"</span>, groupID2);</pre></div></div>
            
        </li>
        
        
        <li id="section-28">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-28">&#182;</a>
              </div>
              <p>The window location then changes to the video-watching page (./video.html) so that the user can watch the group’s videos with the rest of the group.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        <span class="hljs-built_in">window</span>.location.href = <span class="hljs-string">'./video.html'</span>;
      });
    }
  });
});</pre></div></div>
            
        </li>
        
    </ul>
  </div>
</body>
</html>
